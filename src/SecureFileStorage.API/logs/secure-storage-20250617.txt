2025-06-17 14:32:26.884 +02:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 14:32:27.232 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 14:32:27.648 +02:00 [INF] Executed DbCommand (92ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2025-06-17 14:32:27.941 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 14:32:27.945 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 14:32:27.955 +02:00 [INF] Applying migration '20250617123117_InitialCreate'.
2025-06-17 14:32:27.999 +02:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "EncryptedKeys" (
    "Id" uuid NOT NULL,
    "KeyId" text NOT NULL,
    "EncryptedKeyData" bytea NOT NULL,
    "Algorithm" text NOT NULL,
    "Status" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "RotatedAt" timestamp with time zone,
    "ReplacementKeyId" text NOT NULL,
    CONSTRAINT "PK_EncryptedKeys" PRIMARY KEY ("Id")
);
2025-06-17 14:32:28.003 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Roles" (
    "Id" uuid NOT NULL,
    "Name" character varying(50) NOT NULL,
    "Description" text NOT NULL,
    CONSTRAINT "PK_Roles" PRIMARY KEY ("Id")
);
2025-06-17 14:32:28.007 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Users" (
    "Id" uuid NOT NULL,
    "Username" character varying(50) NOT NULL,
    "Email" character varying(100) NOT NULL,
    "PasswordHash" bytea NOT NULL,
    "PasswordSalt" bytea NOT NULL,
    "IsMfaEnabled" boolean NOT NULL,
    "MfaSecret" text NOT NULL,
    "BackupCodes" text[] NOT NULL,
    "PublicKey" bytea NOT NULL,
    "EncryptedPrivateKey" bytea NOT NULL,
    "KeyDerivationAlgorithm" text NOT NULL,
    "KeyDerivationIterations" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "LastLoginAt" timestamp with time zone,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_Users" PRIMARY KEY ("Id")
);
2025-06-17 14:32:28.022 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "SecureFiles" (
    "Id" uuid NOT NULL,
    "FileName" text NOT NULL,
    "OriginalFileName" text NOT NULL,
    "FileSize" bigint NOT NULL,
    "ContentType" text NOT NULL,
    "UploadedAt" timestamp with time zone NOT NULL,
    "OwnerId" uuid NOT NULL,
    "EncryptionAlgorithm" text NOT NULL,
    "KeyId" text NOT NULL,
    "IV" bytea NOT NULL,
    "Salt" bytea NOT NULL,
    "Tag" bytea NOT NULL,
    "EncryptedMetadata" bytea NOT NULL,
    "EncryptedFileKey" bytea NOT NULL,
    "EncryptedChachaKey" bytea NOT NULL,
    "StoragePath" text NOT NULL,
    "FileHash" bytea NOT NULL,
    "HashAlgorithm" text NOT NULL,
    "IsDeleted" boolean NOT NULL,
    "DeletedAt" timestamp with time zone,
    CONSTRAINT "PK_SecureFiles" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_SecureFiles_Users_OwnerId" FOREIGN KEY ("OwnerId") REFERENCES "Users" ("Id") ON DELETE RESTRICT
);
2025-06-17 14:32:28.026 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "UserRoles" (
    "UserId" uuid NOT NULL,
    "RoleId" uuid NOT NULL,
    "AssignedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_UserRoles" PRIMARY KEY ("UserId", "RoleId"),
    CONSTRAINT "FK_UserRoles_Roles_RoleId" FOREIGN KEY ("RoleId") REFERENCES "Roles" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_UserRoles_Users_UserId" FOREIGN KEY ("UserId") REFERENCES "Users" ("Id") ON DELETE CASCADE
);
2025-06-17 14:32:28.032 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "FileAuditLogs" (
    "Id" uuid NOT NULL,
    "FileId" uuid NOT NULL,
    "UserId" uuid NOT NULL,
    "Action" character varying(50) NOT NULL,
    "Details" text NOT NULL,
    "IpAddress" text NOT NULL,
    "UserAgent" text NOT NULL,
    "Timestamp" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_FileAuditLogs" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_FileAuditLogs_SecureFiles_FileId" FOREIGN KEY ("FileId") REFERENCES "SecureFiles" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_FileAuditLogs_Users_UserId" FOREIGN KEY ("UserId") REFERENCES "Users" ("Id") ON DELETE CASCADE
);
2025-06-17 14:32:28.035 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "FilePermissions" (
    "Id" uuid NOT NULL,
    "FileId" uuid NOT NULL,
    "UserId" uuid NOT NULL,
    "Permission" integer NOT NULL,
    "GrantedAt" timestamp with time zone NOT NULL,
    "ExpiresAt" timestamp with time zone,
    "GrantedBy" uuid NOT NULL,
    CONSTRAINT "PK_FilePermissions" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_FilePermissions_SecureFiles_FileId" FOREIGN KEY ("FileId") REFERENCES "SecureFiles" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_FilePermissions_Users_UserId" FOREIGN KEY ("UserId") REFERENCES "Users" ("Id") ON DELETE CASCADE
);
2025-06-17 14:32:28.039 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_EncryptedKeys_KeyId" ON "EncryptedKeys" ("KeyId");
2025-06-17 14:32:28.042 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_FileAuditLogs_FileId" ON "FileAuditLogs" ("FileId");
2025-06-17 14:32:28.044 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_FileAuditLogs_UserId" ON "FileAuditLogs" ("UserId");
2025-06-17 14:32:28.047 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_FilePermissions_FileId" ON "FilePermissions" ("FileId");
2025-06-17 14:32:28.049 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_FilePermissions_UserId" ON "FilePermissions" ("UserId");
2025-06-17 14:32:28.051 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Roles_Name" ON "Roles" ("Name");
2025-06-17 14:32:28.054 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_SecureFiles_OwnerId" ON "SecureFiles" ("OwnerId");
2025-06-17 14:32:28.057 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_UserRoles_RoleId" ON "UserRoles" ("RoleId");
2025-06-17 14:32:28.059 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Users_Email" ON "Users" ("Email");
2025-06-17 14:32:28.062 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Users_Username" ON "Users" ("Username");
2025-06-17 14:32:28.076 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250617123117_InitialCreate', '8.0.8');
2025-06-17 16:30:33.034 +02:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:30:33.076 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 16:30:33.392 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:30:33.800 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:30:33.802 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 16:30:33.811 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 16:30:33.813 +02:00 [INF] Database migration completed successfully
2025-06-17 16:30:33.816 +02:00 [INF] Starting Secure File Storage API
2025-06-17 16:30:33.829 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 16:30:33.864 +02:00 [INF] Creating key {5e61cf74-23c7-4a85-8b7f-574295164414} with creation date 2025-06-17 14:30:33Z, activation date 2025-06-17 14:30:33Z, and expiration date 2025-09-15 14:30:33Z.
2025-06-17 16:30:33.872 +02:00 [INF] Writing data to file 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys\key-5e61cf74-23c7-4a85-8b7f-574295164414.xml'.
2025-06-17 16:30:33.942 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 16:30:33.944 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 16:30:33.945 +02:00 [INF] Hosting environment: Development
2025-06-17 16:30:33.946 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 16:31:21.523 +02:00 [INF] Application is shutting down...
2025-06-17 16:35:52.152 +02:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:35:52.205 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 16:35:52.573 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:35:53.110 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:35:53.137 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 16:35:53.152 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 16:35:53.154 +02:00 [INF] Database migration completed successfully
2025-06-17 16:35:53.159 +02:00 [INF] Starting Secure File Storage API
2025-06-17 16:35:53.172 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 16:35:53.228 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 16:35:53.230 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 16:35:53.231 +02:00 [INF] Hosting environment: Development
2025-06-17 16:35:53.232 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 16:36:31.017 +02:00 [INF] Application is shutting down...
2025-06-17 16:38:46.481 +02:00 [INF] Executed DbCommand (53ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:38:46.553 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 16:38:47.134 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:38:47.580 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:38:47.582 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 16:38:47.590 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 16:38:47.592 +02:00 [INF] Database migration completed successfully
2025-06-17 16:38:47.595 +02:00 [INF] Starting Secure File Storage API
2025-06-17 16:38:47.607 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 16:38:47.652 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 16:38:47.654 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 16:38:47.655 +02:00 [INF] Hosting environment: Development
2025-06-17 16:38:47.656 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 16:40:32.188 +02:00 [INF] Application is shutting down...
2025-06-17 16:59:03.068 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:59:03.107 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 16:59:03.425 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:59:03.861 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 16:59:03.863 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 16:59:03.872 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 16:59:03.873 +02:00 [INF] Database migration completed successfully
2025-06-17 16:59:03.877 +02:00 [INF] Starting Secure File Storage API
2025-06-17 16:59:03.889 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 16:59:03.944 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 16:59:03.947 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 16:59:03.947 +02:00 [INF] Hosting environment: Development
2025-06-17 16:59:03.948 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 17:00:29.078 +02:00 [INF] Application is shutting down...
2025-06-17 17:02:22.139 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:02:22.177 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:02:22.476 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:02:22.778 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:02:22.781 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:02:22.789 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 17:02:22.790 +02:00 [INF] Database migration completed successfully
2025-06-17 17:02:22.793 +02:00 [INF] Starting Secure File Storage API
2025-06-17 17:02:22.804 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 17:02:22.845 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 17:02:22.847 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 17:02:22.848 +02:00 [INF] Hosting environment: Development
2025-06-17 17:02:22.849 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 17:02:52.037 +02:00 [INF] Application is shutting down...
2025-06-17 17:04:37.560 +02:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:04:37.601 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:04:37.932 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:04:38.252 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:04:38.255 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:04:38.264 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 17:04:38.266 +02:00 [INF] Database migration completed successfully
2025-06-17 17:04:38.270 +02:00 [INF] Starting Secure File Storage API
2025-06-17 17:04:38.280 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 17:04:38.324 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 17:04:38.326 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 17:04:38.326 +02:00 [INF] Hosting environment: Development
2025-06-17 17:04:38.327 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 17:05:49.540 +02:00 [INF] Application is shutting down...
2025-06-17 17:07:40.241 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:07:40.279 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:07:40.581 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:07:40.875 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:07:40.878 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:07:40.887 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 17:07:40.889 +02:00 [INF] Database migration completed successfully
2025-06-17 17:07:40.891 +02:00 [INF] Starting Secure File Storage API
2025-06-17 17:07:40.902 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 17:07:40.944 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 17:07:40.947 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 17:07:40.947 +02:00 [INF] Hosting environment: Development
2025-06-17 17:07:40.948 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 17:08:12.789 +02:00 [INF] Application is shutting down...
2025-06-17 17:10:59.909 +02:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:10:59.947 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:11:00.245 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:11:00.540 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:11:00.543 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:11:00.551 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 17:11:00.553 +02:00 [INF] Database migration completed successfully
2025-06-17 17:11:00.556 +02:00 [INF] Starting Secure File Storage API
2025-06-17 17:11:00.568 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 17:11:00.611 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 17:11:00.613 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 17:11:00.614 +02:00 [INF] Hosting environment: Development
2025-06-17 17:11:00.615 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 17:11:38.837 +02:00 [INF] Application is shutting down...
2025-06-17 17:12:51.429 +02:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:12:51.467 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:12:51.770 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:12:52.074 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:12:52.076 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:12:52.086 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 17:12:52.087 +02:00 [INF] Database migration completed successfully
2025-06-17 17:12:52.091 +02:00 [INF] Starting Secure File Storage API
2025-06-17 17:12:52.102 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 17:12:52.148 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 17:12:52.150 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 17:12:52.151 +02:00 [INF] Hosting environment: Development
2025-06-17 17:12:52.152 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 17:12:59.546 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/api/securefiles - null null
2025-06-17 17:12:59.583 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 17:12:59.638 +02:00 [INF] Request 886c4939-7136-4129-aa60-975df91e8e52: GET /api/securefiles
2025-06-17 17:12:59.640 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:12:59.661 +02:00 [INF] Route matched with {action = "GetUserFiles", controller = "SecureFiles"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserFiles() on controller SecureFileStorage.API.Controllers.SecureFilesController (SecureFileStorage.API).
2025-06-17 17:12:59.696 +02:00 [ERR] Error retrieving user files
System.InvalidOperationException: Invalid user ID
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserId() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 274
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 168
2025-06-17 17:12:59.712 +02:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-17 17:12:59.718 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API) in 52.9039ms
2025-06-17 17:12:59.721 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:12:59.722 +02:00 [INF] Response 886c4939-7136-4129-aa60-975df91e8e52: 500
2025-06-17 17:12:59.724 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/api/securefiles - 500 null text/plain; charset=utf-8 181.2661ms
2025-06-17 17:13:00.053 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/favicon.ico - null null
2025-06-17 17:13:00.057 +02:00 [INF] Request 66c40493-3486-4d0f-92a1-abbaa5a8b20c: GET /favicon.ico
2025-06-17 17:13:00.058 +02:00 [INF] Response 66c40493-3486-4d0f-92a1-abbaa5a8b20c: 404
2025-06-17 17:13:00.059 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/favicon.ico - 404 0 null 5.7014ms
2025-06-17 17:13:00.062 +02:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5243/favicon.ico, Response status code: 404
2025-06-17 17:13:23.610 +02:00 [INF] Application is shutting down...
2025-06-17 17:20:32.668 +02:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:20:32.709 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:20:33.009 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:20:33.311 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:20:33.313 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:20:33.322 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 17:20:33.324 +02:00 [INF] Database migration completed successfully
2025-06-17 17:20:33.328 +02:00 [INF] Starting Secure File Storage API
2025-06-17 17:20:33.338 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 17:20:33.382 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 17:20:33.385 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 17:20:33.386 +02:00 [INF] Hosting environment: Development
2025-06-17 17:20:33.386 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 17:20:38.266 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/api/securefiles - null null
2025-06-17 17:20:38.295 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 17:20:38.316 +02:00 [INF] Request b632b102-dc76-437f-873c-e87a6bd472aa: GET /api/securefiles
2025-06-17 17:20:38.317 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:20:38.334 +02:00 [INF] Route matched with {action = "GetUserFiles", controller = "SecureFiles"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserFiles() on controller SecureFileStorage.API.Controllers.SecureFilesController (SecureFileStorage.API).
2025-06-17 17:20:38.341 +02:00 [ERR] Error retrieving user files
System.InvalidOperationException: Invalid user ID
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserId() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 274
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 168
2025-06-17 17:20:38.355 +02:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-17 17:20:38.361 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API) in 23.6384ms
2025-06-17 17:20:38.363 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:20:38.364 +02:00 [INF] Response b632b102-dc76-437f-873c-e87a6bd472aa: 500
2025-06-17 17:20:38.366 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/api/securefiles - 500 null text/plain; charset=utf-8 101.5125ms
2025-06-17 17:20:39.815 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/api/securefiles - null null
2025-06-17 17:20:39.820 +02:00 [INF] Request 86dd20c8-e265-4df6-97d7-74f8f08372b7: GET /api/securefiles
2025-06-17 17:20:39.821 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:20:39.822 +02:00 [INF] Route matched with {action = "GetUserFiles", controller = "SecureFiles"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserFiles() on controller SecureFileStorage.API.Controllers.SecureFilesController (SecureFileStorage.API).
2025-06-17 17:20:39.825 +02:00 [ERR] Error retrieving user files
System.InvalidOperationException: Invalid user ID
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserId() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 274
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 168
2025-06-17 17:20:39.827 +02:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-17 17:20:39.829 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API) in 5.8721ms
2025-06-17 17:20:39.830 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:20:39.831 +02:00 [INF] Response 86dd20c8-e265-4df6-97d7-74f8f08372b7: 500
2025-06-17 17:20:39.832 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/api/securefiles - 500 null text/plain; charset=utf-8 16.5903ms
2025-06-17 17:20:42.330 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/api/securefiles - null null
2025-06-17 17:20:42.337 +02:00 [INF] Request 0255d245-5153-4aaf-8506-044003213827: GET /api/securefiles
2025-06-17 17:20:42.339 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:20:42.340 +02:00 [INF] Route matched with {action = "GetUserFiles", controller = "SecureFiles"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserFiles() on controller SecureFileStorage.API.Controllers.SecureFilesController (SecureFileStorage.API).
2025-06-17 17:20:42.352 +02:00 [ERR] Error retrieving user files
System.InvalidOperationException: Invalid user ID
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserId() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 274
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 168
2025-06-17 17:20:42.355 +02:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-17 17:20:42.357 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API) in 13.6293ms
2025-06-17 17:20:42.359 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:20:42.360 +02:00 [INF] Response 0255d245-5153-4aaf-8506-044003213827: 500
2025-06-17 17:20:42.361 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/api/securefiles - 500 null text/plain; charset=utf-8 31.3828ms
2025-06-17 17:20:47.254 +02:00 [INF] Application is shutting down...
2025-06-17 17:25:06.907 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:25:06.947 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:25:07.262 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:25:07.565 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:25:07.568 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:25:07.577 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 17:25:07.579 +02:00 [INF] Database migration completed successfully
2025-06-17 17:25:07.582 +02:00 [INF] Starting Secure File Storage API
2025-06-17 17:25:07.593 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 17:25:07.636 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 17:25:07.638 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 17:25:07.639 +02:00 [INF] Hosting environment: Development
2025-06-17 17:25:07.640 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 17:25:22.045 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/api/securefiles - null null
2025-06-17 17:25:22.104 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 17:25:22.141 +02:00 [INF] Request 3e0a8fc3-beed-40bb-a247-9acbda6670ee: GET /api/securefiles
2025-06-17 17:25:22.144 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:25:22.175 +02:00 [INF] Route matched with {action = "GetUserFiles", controller = "SecureFiles"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserFiles() on controller SecureFileStorage.API.Controllers.SecureFilesController (SecureFileStorage.API).
2025-06-17 17:25:22.184 +02:00 [ERR] Error retrieving user files
System.InvalidOperationException: Invalid user ID
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserId() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 278
   at SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles() in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\SecureFilesController.cs:line 168
2025-06-17 17:25:22.204 +02:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType2`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-17 17:25:22.227 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API) in 45.6307ms
2025-06-17 17:25:22.230 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 17:25:22.232 +02:00 [INF] Response 3e0a8fc3-beed-40bb-a247-9acbda6670ee: 500
2025-06-17 17:25:22.235 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/api/securefiles - 500 null application/json; charset=utf-8 192.5301ms
2025-06-17 17:29:43.089 +02:00 [INF] Application is shutting down...
2025-06-17 17:43:26.932 +02:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:43:26.972 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:43:27.334 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:43:27.677 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 17:43:27.679 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 17:43:27.687 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 17:43:27.689 +02:00 [INF] Database migration completed successfully
2025-06-17 17:43:27.692 +02:00 [INF] Starting Secure File Storage API
2025-06-17 17:43:27.703 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 17:43:27.750 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 17:43:27.752 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 17:43:27.753 +02:00 [INF] Hosting environment: Development
2025-06-17 17:43:27.754 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 17:43:34.042 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/register - application/json 93
2025-06-17 17:43:34.070 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 17:43:34.122 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-17 17:43:34.128 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-06-17 17:43:34.138 +02:00 [INF] Request 15960318-1599-47c8-84d3-0365650a5f83: POST /api/auth/register
2025-06-17 17:43:34.140 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 17:43:34.154 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(SecureFileStorage.Core.DTOs.RegisterRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 17:43:34.523 +02:00 [INF] Executed DbCommand (31ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 17:43:34.537 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Email" = @__email_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 17:43:34.846 +02:00 [ERR] Failed executing DbCommand (73ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Object), @p2='?' (DbType = DateTime), @p3='?', @p4='?' (DbType = Binary), @p5='?' (DbType = Boolean), @p6='?' (DbType = Boolean), @p7='?', @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime), @p10='?', @p11='?' (DbType = Binary), @p12='?' (DbType = Binary), @p13='?' (DbType = Binary), @p14='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Users" ("Id", "BackupCodes", "CreatedAt", "Email", "EncryptedPrivateKey", "IsActive", "IsMfaEnabled", "KeyDerivationAlgorithm", "KeyDerivationIterations", "LastLoginAt", "MfaSecret", "PasswordHash", "PasswordSalt", "PublicKey", "Username")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-06-17 17:43:34.858 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'SecureFileStorage.Infrastructure.Data.SecureStorageDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "MfaSecret" of relation "Users" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "MfaSecret" of relation "Users" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Users
    ColumnName: MfaSecret
    File: execMain.c
    Line: 1993
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "MfaSecret" of relation "Users" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "MfaSecret" of relation "Users" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Users
    ColumnName: MfaSecret
    File: execMain.c
    Line: 1993
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-06-17 17:43:34.866 +02:00 [ERR] Error during registration
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "MfaSecret" of relation "Users" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "MfaSecret" of relation "Users" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Users
    ColumnName: MfaSecret
    File: execMain.c
    Line: 1993
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at SecureFileStorage.Infrastructure.Repositories.UserRepository.CreateAsync(User user) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.Infrastructure\Repositories\UserRepository.cs:line 45
   at SecureFileStorage.API.Controllers.AuthController.Register(RegisterRequest request) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\AuthController.cs:line 85
2025-06-17 17:43:34.885 +02:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-17 17:43:34.890 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API) in 732.6095ms
2025-06-17 17:43:34.893 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 17:43:34.894 +02:00 [INF] Response 15960318-1599-47c8-84d3-0365650a5f83: 500
2025-06-17 17:43:34.898 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/register - 500 null text/plain; charset=utf-8 857.1191ms
2025-06-17 17:44:18.980 +02:00 [INF] Application is shutting down...
2025-06-17 18:39:16.610 +02:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:39:16.649 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 18:39:17.095 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:39:17.454 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:39:17.457 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 18:39:17.466 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 18:39:17.467 +02:00 [INF] Database migration completed successfully
2025-06-17 18:39:17.470 +02:00 [INF] Starting Secure File Storage API
2025-06-17 18:39:17.482 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 18:39:17.524 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 18:39:17.526 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 18:39:17.526 +02:00 [INF] Hosting environment: Development
2025-06-17 18:39:17.527 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 18:40:00.526 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/api/test/ping - application/json 93
2025-06-17 18:40:00.577 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 18:40:00.641 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-17 18:40:00.652 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-06-17 18:40:00.661 +02:00 [INF] Request 7da4bf91-d895-4e45-8e93-75ec62678b5c: GET /api/test/ping
2025-06-17 18:40:00.664 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.TestController.Ping (SecureFileStorage.API)'
2025-06-17 18:40:00.684 +02:00 [INF] Route matched with {action = "Ping", controller = "Test"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Ping() on controller SecureFileStorage.API.Controllers.TestController (SecureFileStorage.API).
2025-06-17 18:40:00.688 +02:00 [INF] Ping endpoint called
2025-06-17 18:40:00.691 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType4`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-17 18:40:00.727 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.TestController.Ping (SecureFileStorage.API) in 36.9739ms
2025-06-17 18:40:00.730 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.TestController.Ping (SecureFileStorage.API)'
2025-06-17 18:40:00.731 +02:00 [INF] Response 7da4bf91-d895-4e45-8e93-75ec62678b5c: 200
2025-06-17 18:40:00.734 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/api/test/ping - 200 null application/json; charset=utf-8 209.2832ms
2025-06-17 18:40:47.259 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/register - application/json 146
2025-06-17 18:40:47.266 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-17 18:40:47.269 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-06-17 18:40:47.271 +02:00 [INF] Request ed292d88-6d49-4294-95d9-91eea6a97f7f: POST /api/auth/register
2025-06-17 18:40:47.272 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 18:40:47.293 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(SecureFileStorage.Core.DTOs.RegisterRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 18:40:47.684 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 18:40:47.706 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Email" = @__email_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 18:40:48.150 +02:00 [ERR] Failed executing DbCommand (97ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Object), @p2='?' (DbType = DateTime), @p3='?', @p4='?' (DbType = Binary), @p5='?' (DbType = Boolean), @p6='?' (DbType = Boolean), @p7='?', @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime), @p10='?', @p11='?' (DbType = Binary), @p12='?' (DbType = Binary), @p13='?' (DbType = Binary), @p14='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Users" ("Id", "BackupCodes", "CreatedAt", "Email", "EncryptedPrivateKey", "IsActive", "IsMfaEnabled", "KeyDerivationAlgorithm", "KeyDerivationIterations", "LastLoginAt", "MfaSecret", "PasswordHash", "PasswordSalt", "PublicKey", "Username")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-06-17 18:40:48.165 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'SecureFileStorage.Infrastructure.Data.SecureStorageDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "MfaSecret" of relation "Users" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "MfaSecret" of relation "Users" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Users
    ColumnName: MfaSecret
    File: execMain.c
    Line: 1993
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "MfaSecret" of relation "Users" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "MfaSecret" of relation "Users" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Users
    ColumnName: MfaSecret
    File: execMain.c
    Line: 1993
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-06-17 18:40:48.179 +02:00 [ERR] Error during registration
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "MfaSecret" of relation "Users" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "MfaSecret" of relation "Users" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Users
    ColumnName: MfaSecret
    File: execMain.c
    Line: 1993
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at SecureFileStorage.Infrastructure.Repositories.UserRepository.CreateAsync(User user) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.Infrastructure\Repositories\UserRepository.cs:line 45
   at SecureFileStorage.API.Controllers.AuthController.Register(RegisterRequest request) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\AuthController.cs:line 85
2025-06-17 18:40:48.198 +02:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-17 18:40:48.201 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API) in 905.3522ms
2025-06-17 18:40:48.203 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 18:40:48.205 +02:00 [INF] Response ed292d88-6d49-4294-95d9-91eea6a97f7f: 500
2025-06-17 18:40:48.211 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/register - 500 null text/plain; charset=utf-8 951.9413ms
2025-06-17 18:41:34.283 +02:00 [INF] Application is shutting down...
2025-06-17 18:41:45.008 +02:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:41:45.046 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 18:41:45.364 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:41:45.676 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:41:45.678 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 18:41:45.687 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 18:41:45.688 +02:00 [INF] Database migration completed successfully
2025-06-17 18:41:45.691 +02:00 [INF] Starting Secure File Storage API
2025-06-17 18:41:45.701 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 18:41:45.742 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 18:41:45.744 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 18:41:45.745 +02:00 [INF] Hosting environment: Development
2025-06-17 18:41:45.746 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 18:41:51.507 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/register - application/json 146
2025-06-17 18:41:51.532 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 18:41:51.573 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-17 18:41:51.582 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-06-17 18:41:51.588 +02:00 [INF] Request 47c77397-e7e3-4055-adea-dae3d8012cfa: POST /api/auth/register
2025-06-17 18:41:51.590 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 18:41:51.609 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(SecureFileStorage.Core.DTOs.RegisterRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 18:41:51.825 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 18:41:51.838 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Email" = @__email_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 18:41:52.035 +02:00 [ERR] Failed executing DbCommand (36ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Object), @p2='?' (DbType = DateTime), @p3='?', @p4='?' (DbType = Binary), @p5='?' (DbType = Boolean), @p6='?' (DbType = Boolean), @p7='?', @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime), @p10='?', @p11='?' (DbType = Binary), @p12='?' (DbType = Binary), @p13='?' (DbType = Binary), @p14='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Users" ("Id", "BackupCodes", "CreatedAt", "Email", "EncryptedPrivateKey", "IsActive", "IsMfaEnabled", "KeyDerivationAlgorithm", "KeyDerivationIterations", "LastLoginAt", "MfaSecret", "PasswordHash", "PasswordSalt", "PublicKey", "Username")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-06-17 18:41:52.046 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'SecureFileStorage.Infrastructure.Data.SecureStorageDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "MfaSecret" of relation "Users" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "MfaSecret" of relation "Users" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Users
    ColumnName: MfaSecret
    File: execMain.c
    Line: 1993
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "MfaSecret" of relation "Users" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "MfaSecret" of relation "Users" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Users
    ColumnName: MfaSecret
    File: execMain.c
    Line: 1993
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-06-17 18:41:52.055 +02:00 [ERR] Error during registration
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "MfaSecret" of relation "Users" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "MfaSecret" of relation "Users" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Users
    ColumnName: MfaSecret
    File: execMain.c
    Line: 1993
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at SecureFileStorage.Infrastructure.Repositories.UserRepository.CreateAsync(User user) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.Infrastructure\Repositories\UserRepository.cs:line 45
   at SecureFileStorage.API.Controllers.AuthController.Register(RegisterRequest request) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\AuthController.cs:line 85
2025-06-17 18:41:52.067 +02:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-17 18:41:52.072 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API) in 459.2749ms
2025-06-17 18:41:52.074 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 18:41:52.075 +02:00 [INF] Response 47c77397-e7e3-4055-adea-dae3d8012cfa: 500
2025-06-17 18:41:52.079 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/register - 500 null text/plain; charset=utf-8 573.3182ms
2025-06-17 18:42:55.891 +02:00 [INF] Application is shutting down...
2025-06-17 18:53:29.453 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:53:29.488 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 18:53:29.812 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:53:30.146 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:53:30.148 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 18:53:30.157 +02:00 [INF] Applying migration '20250617165108_MakeMfaSecretNullable'.
2025-06-17 18:53:30.207 +02:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ALTER COLUMN "MfaSecret" DROP NOT NULL;
2025-06-17 18:53:30.209 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ALTER COLUMN "BackupCodes" DROP NOT NULL;
2025-06-17 18:53:30.211 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "EncryptedKeys" ALTER COLUMN "ReplacementKeyId" DROP NOT NULL;
2025-06-17 18:53:30.218 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250617165108_MakeMfaSecretNullable', '8.0.8');
2025-06-17 18:53:39.494 +02:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:53:39.535 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 18:53:39.848 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:53:40.173 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 18:53:40.175 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 18:53:40.183 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 18:53:40.185 +02:00 [INF] Database migration completed successfully
2025-06-17 18:53:40.188 +02:00 [INF] Starting Secure File Storage API
2025-06-17 18:53:40.200 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 18:53:40.241 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 18:53:40.243 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 18:53:40.244 +02:00 [INF] Hosting environment: Development
2025-06-17 18:53:40.245 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 18:53:46.968 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/register - application/json 146
2025-06-17 18:53:46.995 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 18:53:47.033 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-17 18:53:47.042 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-06-17 18:53:47.047 +02:00 [INF] Request d5c8e4d9-b0a9-496d-a7ac-be462706ed90: POST /api/auth/register
2025-06-17 18:53:47.049 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 18:53:47.066 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(SecureFileStorage.Core.DTOs.RegisterRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 18:53:47.279 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 18:53:47.293 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Email" = @__email_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 18:53:47.485 +02:00 [INF] Executed DbCommand (38ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Object), @p2='?' (DbType = DateTime), @p3='?', @p4='?' (DbType = Binary), @p5='?' (DbType = Boolean), @p6='?' (DbType = Boolean), @p7='?', @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime), @p10='?', @p11='?' (DbType = Binary), @p12='?' (DbType = Binary), @p13='?' (DbType = Binary), @p14='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Users" ("Id", "BackupCodes", "CreatedAt", "Email", "EncryptedPrivateKey", "IsActive", "IsMfaEnabled", "KeyDerivationAlgorithm", "KeyDerivationIterations", "LastLoginAt", "MfaSecret", "PasswordHash", "PasswordSalt", "PublicKey", "Username")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-06-17 18:53:47.542 +02:00 [ERR] Failed executing DbCommand (22ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?', @p3='?' (DbType = Guid), @p4='?', @p5='?' (DbType = DateTime), @p6='?', @p7='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FileAuditLogs" ("Id", "Action", "Details", "FileId", "IpAddress", "Timestamp", "UserAgent", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-17 18:53:47.551 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'SecureFileStorage.Infrastructure.Data.SecureStorageDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "FileAuditLogs" violates foreign key constraint "FK_FileAuditLogs_SecureFiles_FileId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "FileAuditLogs" violates foreign key constraint "FK_FileAuditLogs_SecureFiles_FileId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: FileAuditLogs
    ConstraintName: FK_FileAuditLogs_SecureFiles_FileId
    File: ri_triggers.c
    Line: 2610
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "FileAuditLogs" violates foreign key constraint "FK_FileAuditLogs_SecureFiles_FileId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "FileAuditLogs" violates foreign key constraint "FK_FileAuditLogs_SecureFiles_FileId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: FileAuditLogs
    ConstraintName: FK_FileAuditLogs_SecureFiles_FileId
    File: ri_triggers.c
    Line: 2610
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-06-17 18:53:47.559 +02:00 [ERR] Error during registration
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "FileAuditLogs" violates foreign key constraint "FK_FileAuditLogs_SecureFiles_FileId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "FileAuditLogs" violates foreign key constraint "FK_FileAuditLogs_SecureFiles_FileId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: FileAuditLogs
    ConstraintName: FK_FileAuditLogs_SecureFiles_FileId
    File: ri_triggers.c
    Line: 2610
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at SecureFileStorage.Infrastructure.Services.AuditService.LogSecurityEventAsync(Guid userId, String eventType, String details) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.Infrastructure\Services\AuditService.cs:line 60
   at SecureFileStorage.API.Controllers.AuthController.Register(RegisterRequest request) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\AuthController.cs:line 88
2025-06-17 18:53:47.571 +02:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-17 18:53:47.575 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API) in 505.3094ms
2025-06-17 18:53:47.578 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 18:53:47.579 +02:00 [INF] Response d5c8e4d9-b0a9-496d-a7ac-be462706ed90: 500
2025-06-17 18:53:47.583 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/register - 500 null text/plain; charset=utf-8 615.8968ms
2025-06-17 18:57:31.426 +02:00 [INF] Application is shutting down...
2025-06-17 20:10:54.439 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:10:54.478 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:10:54.797 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:10:55.116 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:10:55.119 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:10:55.127 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 20:10:55.128 +02:00 [INF] Database migration completed successfully
2025-06-17 20:10:55.131 +02:00 [INF] Starting Secure File Storage API
2025-06-17 20:10:55.141 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 20:10:55.182 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 20:10:55.184 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 20:10:55.185 +02:00 [INF] Hosting environment: Development
2025-06-17 20:10:55.186 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 20:11:19.889 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/register - application/json 146
2025-06-17 20:11:19.937 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 20:11:20.001 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-17 20:11:20.013 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-06-17 20:11:20.023 +02:00 [INF] Request 0ae23f73-ec05-4e95-b8ef-3d8a6ba13d0e: POST /api/auth/register
2025-06-17 20:11:20.026 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 20:11:20.058 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(SecureFileStorage.Core.DTOs.RegisterRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 20:11:20.451 +02:00 [INF] Executed DbCommand (25ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:11:20.624 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-06-17 20:11:20.635 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API) in 569.4529ms
2025-06-17 20:11:20.638 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 20:11:20.640 +02:00 [INF] Response 0ae23f73-ec05-4e95-b8ef-3d8a6ba13d0e: 400
2025-06-17 20:11:20.647 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/register - 400 null text/plain; charset=utf-8 759.5224ms
2025-06-17 20:11:32.339 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/register - application/json 146
2025-06-17 20:11:32.347 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-17 20:11:32.351 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-06-17 20:11:32.352 +02:00 [INF] Request 2a78c2d5-6637-4bd4-8838-ba96f7179cfc: POST /api/auth/register
2025-06-17 20:11:32.354 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 20:11:32.355 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(SecureFileStorage.Core.DTOs.RegisterRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 20:11:32.423 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:11:32.445 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Email" = @__email_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:11:32.449 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-06-17 20:11:32.451 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API) in 93.7389ms
2025-06-17 20:11:32.453 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 20:11:32.454 +02:00 [INF] Response 2a78c2d5-6637-4bd4-8838-ba96f7179cfc: 400
2025-06-17 20:11:32.456 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/register - 400 null text/plain; charset=utf-8 116.7123ms
2025-06-17 20:14:34.914 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/api/securefiles - null null
2025-06-17 20:14:34.932 +02:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-06-17 20:14:34.937 +02:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-06-17 20:14:34.938 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/api/securefiles - 401 0 null 24.3676ms
2025-06-17 20:14:48.504 +02:00 [INF] Application is shutting down...
2025-06-17 20:14:56.881 +02:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:14:56.923 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:14:57.263 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:14:57.614 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:14:57.617 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:14:57.625 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 20:14:57.626 +02:00 [INF] Database migration completed successfully
2025-06-17 20:14:57.630 +02:00 [INF] Starting Secure File Storage API
2025-06-17 20:14:57.640 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 20:14:57.680 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 20:14:57.683 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 20:14:57.683 +02:00 [INF] Hosting environment: Development
2025-06-17 20:14:57.684 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 20:18:02.427 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/login - application/json 67
2025-06-17 20:18:02.473 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 20:18:02.538 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-17 20:18:02.550 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-06-17 20:18:02.560 +02:00 [INF] Request f1e5eb90-86a4-4f4b-9d35-b0a554614c3e: POST /api/auth/login
2025-06-17 20:18:02.563 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:18:02.594 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(SecureFileStorage.Core.DTOs.LoginRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 20:18:02.967 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:18:03.299 +02:00 [INF] Executed DbCommand (50ms) [Parameters=[@p14='?' (DbType = Guid), @p0='?' (DbType = Object), @p1='?' (DbType = DateTime), @p2='?', @p3='?' (DbType = Binary), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?', @p7='?' (DbType = Int32), @p8='?' (DbType = DateTime), @p9='?', @p10='?' (DbType = Binary), @p11='?' (DbType = Binary), @p12='?' (DbType = Binary), @p13='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "BackupCodes" = @p0, "CreatedAt" = @p1, "Email" = @p2, "EncryptedPrivateKey" = @p3, "IsActive" = @p4, "IsMfaEnabled" = @p5, "KeyDerivationAlgorithm" = @p6, "KeyDerivationIterations" = @p7, "LastLoginAt" = @p8, "MfaSecret" = @p9, "PasswordHash" = @p10, "PasswordSalt" = @p11, "PublicKey" = @p12, "Username" = @p13
WHERE "Id" = @p14;
2025-06-17 20:18:03.403 +02:00 [ERR] Failed executing DbCommand (24ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?', @p3='?', @p4='?' (DbType = DateTime), @p5='?', @p6='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "UserAuditLogs" ("Id", "Details", "EventType", "IpAddress", "Timestamp", "UserAgent", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-17 20:18:03.446 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'SecureFileStorage.Infrastructure.Data.SecureStorageDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42P01: relation "UserAuditLogs" does not exist

POSITION: 13
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42P01
    MessageText: relation "UserAuditLogs" does not exist
    Position: 13
    File: parse_relation.c
    Line: 1452
    Routine: parserOpenTable
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42P01: relation "UserAuditLogs" does not exist

POSITION: 13
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42P01
    MessageText: relation "UserAuditLogs" does not exist
    Position: 13
    File: parse_relation.c
    Line: 1452
    Routine: parserOpenTable
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-06-17 20:18:03.459 +02:00 [ERR] Error during login
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42P01: relation "UserAuditLogs" does not exist

POSITION: 13
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42P01
    MessageText: relation "UserAuditLogs" does not exist
    Position: 13
    File: parse_relation.c
    Line: 1452
    Routine: parserOpenTable
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at SecureFileStorage.Infrastructure.Services.AuditService.LogUserSecurityEventAsync(Guid userId, String eventType, String details) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.Infrastructure\Services\AuditService.cs:line 92
   at SecureFileStorage.API.Controllers.AuthController.Login(LoginRequest request) in C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API\Controllers\AuthController.cs:line 144
2025-06-17 20:18:03.479 +02:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-17 20:18:03.486 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API) in 885.9648ms
2025-06-17 20:18:03.489 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:18:03.491 +02:00 [INF] Response f1e5eb90-86a4-4f4b-9d35-b0a554614c3e: 500
2025-06-17 20:18:03.497 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/login - 500 null text/plain; charset=utf-8 1071.7239ms
2025-06-17 20:18:55.899 +02:00 [INF] Application is shutting down...
2025-06-17 20:31:36.520 +02:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:31:36.555 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:31:36.886 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:31:37.243 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:31:37.245 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:31:37.254 +02:00 [INF] Applying migration '20250617183101_AddUserAuditLogTable'.
2025-06-17 20:31:37.326 +02:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "FileAuditLogs" DROP CONSTRAINT "FK_FileAuditLogs_SecureFiles_FileId";
2025-06-17 20:31:37.368 +02:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "UserAuditLogs" (
    "Id" uuid NOT NULL,
    "UserId" uuid NOT NULL,
    "EventType" character varying(50) NOT NULL,
    "Details" text NOT NULL,
    "IpAddress" text NOT NULL,
    "UserAgent" text NOT NULL,
    "Timestamp" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_UserAuditLogs" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_UserAuditLogs_Users_UserId" FOREIGN KEY ("UserId") REFERENCES "Users" ("Id") ON DELETE CASCADE
);
2025-06-17 20:31:37.373 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_UserAuditLogs_UserId" ON "UserAuditLogs" ("UserId");
2025-06-17 20:31:37.378 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "FileAuditLogs" ADD CONSTRAINT "FK_FileAuditLogs_SecureFiles_FileId" FOREIGN KEY ("FileId") REFERENCES "SecureFiles" ("Id") ON DELETE RESTRICT;
2025-06-17 20:31:37.380 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250617183101_AddUserAuditLogTable', '8.0.8');
2025-06-17 20:32:00.326 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:32:00.365 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:32:00.693 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:32:01.014 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:32:01.017 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:32:01.026 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 20:32:01.027 +02:00 [INF] Database migration completed successfully
2025-06-17 20:32:01.031 +02:00 [INF] Starting Secure File Storage API
2025-06-17 20:32:01.042 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 20:32:01.084 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 20:32:01.086 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 20:32:01.087 +02:00 [INF] Hosting environment: Development
2025-06-17 20:32:01.087 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 20:32:10.477 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/login - application/json 67
2025-06-17 20:32:10.529 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 20:32:10.596 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-17 20:32:10.607 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-06-17 20:32:10.617 +02:00 [INF] Request b8f555ff-bfe9-4082-9312-b8c9fd432c71: POST /api/auth/login
2025-06-17 20:32:10.620 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:32:10.652 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(SecureFileStorage.Core.DTOs.LoginRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 20:32:11.037 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:32:11.315 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@p14='?' (DbType = Guid), @p0='?' (DbType = Object), @p1='?' (DbType = DateTime), @p2='?', @p3='?' (DbType = Binary), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?', @p7='?' (DbType = Int32), @p8='?' (DbType = DateTime), @p9='?', @p10='?' (DbType = Binary), @p11='?' (DbType = Binary), @p12='?' (DbType = Binary), @p13='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "BackupCodes" = @p0, "CreatedAt" = @p1, "Email" = @p2, "EncryptedPrivateKey" = @p3, "IsActive" = @p4, "IsMfaEnabled" = @p5, "KeyDerivationAlgorithm" = @p6, "KeyDerivationIterations" = @p7, "LastLoginAt" = @p8, "MfaSecret" = @p9, "PasswordHash" = @p10, "PasswordSalt" = @p11, "PublicKey" = @p12, "Username" = @p13
WHERE "Id" = @p14;
2025-06-17 20:32:11.396 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?', @p3='?', @p4='?' (DbType = DateTime), @p5='?', @p6='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "UserAuditLogs" ("Id", "Details", "EventType", "IpAddress", "Timestamp", "UserAgent", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-17 20:32:11.404 +02:00 [INF] Executing OkObjectResult, writing value of type 'SecureFileStorage.Core.DTOs.LoginResponse'.
2025-06-17 20:32:11.432 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API) in 772.6443ms
2025-06-17 20:32:11.435 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:32:11.437 +02:00 [INF] Response b8f555ff-bfe9-4082-9312-b8c9fd432c71: 200
2025-06-17 20:32:11.445 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/login - 200 null application/json; charset=utf-8 969.7709ms
2025-06-17 20:34:23.531 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/api/securefiles - null null
2025-06-17 20:34:23.563 +02:00 [INF] Request a033d535-7aff-4faa-828f-15cd6fe7b925: GET /api/securefiles
2025-06-17 20:34:23.564 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 20:34:23.570 +02:00 [INF] Route matched with {action = "GetUserFiles", controller = "SecureFiles"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserFiles() on controller SecureFileStorage.API.Controllers.SecureFilesController (SecureFileStorage.API).
2025-06-17 20:34:23.580 +02:00 [INF] User 30052f52-0b49-421f-8c78-d9aa8d55bcf3 retrieving files
2025-06-17 20:34:23.699 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT s."Id", s."ContentType", s."DeletedAt", s."EncryptedChachaKey", s."EncryptedFileKey", s."EncryptedMetadata", s."EncryptionAlgorithm", s."FileHash", s."FileName", s."FileSize", s."HashAlgorithm", s."IV", s."IsDeleted", s."KeyId", s."OriginalFileName", s."OwnerId", s."Salt", s."StoragePath", s."Tag", s."UploadedAt"
FROM "SecureFiles" AS s
WHERE s."OwnerId" = @__userId_0 AND NOT (s."IsDeleted")
ORDER BY s."UploadedAt" DESC
2025-06-17 20:34:23.704 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[SecureFileStorage.Core.DTOs.FileDto, SecureFileStorage.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-17 20:34:23.719 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API) in 146.4815ms
2025-06-17 20:34:23.722 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 20:34:23.723 +02:00 [INF] Response a033d535-7aff-4faa-828f-15cd6fe7b925: 200
2025-06-17 20:34:23.725 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/api/securefiles - 200 null application/json; charset=utf-8 193.4335ms
2025-06-17 20:44:55.398 +02:00 [INF] Application is shutting down...
2025-06-17 20:49:09.357 +02:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:49:09.395 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:49:09.738 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:49:10.081 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:49:10.083 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:49:10.092 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 20:49:10.094 +02:00 [INF] Database migration completed successfully
2025-06-17 20:49:10.096 +02:00 [INF] Starting Secure File Storage API
2025-06-17 20:49:10.107 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 20:49:10.153 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 20:49:10.154 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 20:49:10.155 +02:00 [INF] Hosting environment: Development
2025-06-17 20:49:10.156 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 20:51:41.357 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/login - application/json 66
2025-06-17 20:51:41.405 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 20:51:41.501 +02:00 [INF] Request 40896d91-beba-469a-9cc1-c2e050accdb0: POST /api/auth/login
2025-06-17 20:51:41.504 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:51:41.537 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(SecureFileStorage.Core.DTOs.LoginRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 20:51:41.951 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:51:42.323 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?', @p3='?', @p4='?' (DbType = DateTime), @p5='?', @p6='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "UserAuditLogs" ("Id", "Details", "EventType", "IpAddress", "Timestamp", "UserAgent", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-17 20:51:42.343 +02:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'System.String'.
2025-06-17 20:51:42.352 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API) in 808.7823ms
2025-06-17 20:51:42.355 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:51:42.357 +02:00 [INF] Response 40896d91-beba-469a-9cc1-c2e050accdb0: 401
2025-06-17 20:51:42.368 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/login - 401 null text/plain; charset=utf-8 1012.2306ms
2025-06-17 20:51:51.025 +02:00 [INF] Application is shutting down...
2025-06-17 20:53:43.115 +02:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:53:43.156 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:53:43.495 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:53:43.820 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 20:53:43.823 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 20:53:43.832 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 20:53:43.834 +02:00 [INF] Database migration completed successfully
2025-06-17 20:53:43.838 +02:00 [INF] Starting Secure File Storage API
2025-06-17 20:53:43.851 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 20:53:43.898 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 20:53:43.900 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 20:53:43.901 +02:00 [INF] Hosting environment: Development
2025-06-17 20:53:43.902 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 20:53:48.871 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/login - application/json 64
2025-06-17 20:53:48.898 +02:00 [WRN] Failed to determine the https port for redirect.
2025-06-17 20:53:48.946 +02:00 [INF] Request ce2e08f9-c023-4a58-8010-4dc0d7123073: POST /api/auth/login
2025-06-17 20:53:48.948 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:53:48.963 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(SecureFileStorage.Core.DTOs.LoginRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 20:53:49.169 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:53:49.347 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?', @p3='?', @p4='?' (DbType = DateTime), @p5='?', @p6='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "UserAuditLogs" ("Id", "Details", "EventType", "IpAddress", "Timestamp", "UserAgent", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-17 20:53:49.357 +02:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'System.String'.
2025-06-17 20:53:49.362 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API) in 395.4981ms
2025-06-17 20:53:49.364 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:53:49.365 +02:00 [INF] Response ce2e08f9-c023-4a58-8010-4dc0d7123073: 401
2025-06-17 20:53:49.369 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/login - 401 null text/plain; charset=utf-8 498.1118ms
2025-06-17 20:56:17.051 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/register - application/json 113
2025-06-17 20:56:17.057 +02:00 [INF] Request 9dddfd64-066c-4db0-a615-40b750832849: POST /api/auth/register
2025-06-17 20:56:17.057 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 20:56:17.062 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(SecureFileStorage.Core.DTOs.RegisterRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 20:56:17.104 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:56:17.117 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Email" = @__email_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:56:17.241 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Object), @p2='?' (DbType = DateTime), @p3='?', @p4='?' (DbType = Binary), @p5='?' (DbType = Boolean), @p6='?' (DbType = Boolean), @p7='?', @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime), @p10='?', @p11='?' (DbType = Binary), @p12='?' (DbType = Binary), @p13='?' (DbType = Binary), @p14='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Users" ("Id", "BackupCodes", "CreatedAt", "Email", "EncryptedPrivateKey", "IsActive", "IsMfaEnabled", "KeyDerivationAlgorithm", "KeyDerivationIterations", "LastLoginAt", "MfaSecret", "PasswordHash", "PasswordSalt", "PublicKey", "Username")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-06-17 20:56:17.246 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?', @p3='?', @p4='?' (DbType = DateTime), @p5='?', @p6='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "UserAuditLogs" ("Id", "Details", "EventType", "IpAddress", "Timestamp", "UserAgent", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-17 20:56:17.253 +02:00 [INF] Executing OkObjectResult, writing value of type 'SecureFileStorage.Core.DTOs.RegisterResponse'.
2025-06-17 20:56:17.260 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API) in 196.4658ms
2025-06-17 20:56:17.261 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Register (SecureFileStorage.API)'
2025-06-17 20:56:17.262 +02:00 [INF] Response 9dddfd64-066c-4db0-a615-40b750832849: 200
2025-06-17 20:56:17.263 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/register - 200 null application/json; charset=utf-8 211.3332ms
2025-06-17 20:56:42.715 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/auth/login - application/json 73
2025-06-17 20:56:42.719 +02:00 [INF] Request fde7c791-6633-4563-b7cb-f060ed11cd17: POST /api/auth/login
2025-06-17 20:56:42.720 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:56:42.721 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(SecureFileStorage.Core.DTOs.LoginRequest) on controller SecureFileStorage.API.Controllers.AuthController (SecureFileStorage.API).
2025-06-17 20:56:42.727 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__username_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Username" = @__username_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:56:42.764 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[@p14='?' (DbType = Guid), @p0='?' (DbType = Object), @p1='?' (DbType = DateTime), @p2='?', @p3='?' (DbType = Binary), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?', @p7='?' (DbType = Int32), @p8='?' (DbType = DateTime), @p9='?', @p10='?' (DbType = Binary), @p11='?' (DbType = Binary), @p12='?' (DbType = Binary), @p13='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "BackupCodes" = @p0, "CreatedAt" = @p1, "Email" = @p2, "EncryptedPrivateKey" = @p3, "IsActive" = @p4, "IsMfaEnabled" = @p5, "KeyDerivationAlgorithm" = @p6, "KeyDerivationIterations" = @p7, "LastLoginAt" = @p8, "MfaSecret" = @p9, "PasswordHash" = @p10, "PasswordSalt" = @p11, "PublicKey" = @p12, "Username" = @p13
WHERE "Id" = @p14;
2025-06-17 20:56:42.769 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?', @p3='?', @p4='?' (DbType = DateTime), @p5='?', @p6='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "UserAuditLogs" ("Id", "Details", "EventType", "IpAddress", "Timestamp", "UserAgent", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-17 20:56:42.771 +02:00 [INF] Executing OkObjectResult, writing value of type 'SecureFileStorage.Core.DTOs.LoginResponse'.
2025-06-17 20:56:42.775 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API) in 52.2179ms
2025-06-17 20:56:42.776 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.AuthController.Login (SecureFileStorage.API)'
2025-06-17 20:56:42.777 +02:00 [INF] Response fde7c791-6633-4563-b7cb-f060ed11cd17: 200
2025-06-17 20:56:42.777 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/auth/login - 200 null application/json; charset=utf-8 62.1381ms
2025-06-17 20:59:02.892 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/SecureFiles/upload - multipart/form-data; boundary=--------------------------521814947905391071191499 207876
2025-06-17 20:59:02.895 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenMalformedException: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
 ---> Microsoft.IdentityModel.Tokens.SecurityTokenMalformedException: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken.ReadToken(String encodedJson)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken..ctor(String jwtEncodedString)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ReadToken(String token, TokenValidationParameters validationParameters)
   --- End of inner exception stack trace ---
2025-06-17 20:59:02.900 +02:00 [INF] Bearer was not authenticated. Failure message: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
2025-06-17 20:59:02.904 +02:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-06-17 20:59:02.907 +02:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-06-17 20:59:02.908 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/SecureFiles/upload - 401 0 null 15.9361ms
2025-06-17 20:59:42.186 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5243/api/SecureFiles/upload - multipart/form-data; boundary=--------------------------497240762838673585717080 207876
2025-06-17 20:59:42.191 +02:00 [INF] Request 60f63ab2-843e-4b5e-9647-92d1de3e2949: POST /api/SecureFiles/upload
2025-06-17 20:59:42.192 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.UploadFile (SecureFileStorage.API)'
2025-06-17 20:59:42.209 +02:00 [INF] Route matched with {action = "UploadFile", controller = "SecureFiles"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UploadFile(Microsoft.AspNetCore.Http.IFormFile) on controller SecureFileStorage.API.Controllers.SecureFilesController (SecureFileStorage.API).
2025-06-17 20:59:42.239 +02:00 [INF] User 71edeb10-4271-47e2-9b43-71cd805f4680 attempting to upload file: tree.txt
2025-06-17 20:59:42.360 +02:00 [INF] Starting encryption for file tree.txt
2025-06-17 20:59:42.729 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Id" = @__id_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:59:42.739 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BackupCodes", t."CreatedAt", t."Email", t."EncryptedPrivateKey", t."IsActive", t."IsMfaEnabled", t."KeyDerivationAlgorithm", t."KeyDerivationIterations", t."LastLoginAt", t."MfaSecret", t."PasswordHash", t."PasswordSalt", t."PublicKey", t."Username", t0."UserId", t0."RoleId", t0."AssignedAt", t0."Id", t0."Description", t0."Name"
FROM (
    SELECT u."Id", u."BackupCodes", u."CreatedAt", u."Email", u."EncryptedPrivateKey", u."IsActive", u."IsMfaEnabled", u."KeyDerivationAlgorithm", u."KeyDerivationIterations", u."LastLoginAt", u."MfaSecret", u."PasswordHash", u."PasswordSalt", u."PublicKey", u."Username"
    FROM "Users" AS u
    WHERE u."Id" = @__id_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT u0."UserId", u0."RoleId", u0."AssignedAt", r."Id", r."Description", r."Name"
    FROM "UserRoles" AS u0
    INNER JOIN "Roles" AS r ON u0."RoleId" = r."Id"
) AS t0 ON t."Id" = t0."UserId"
ORDER BY t."Id", t0."UserId", t0."RoleId"
2025-06-17 20:59:42.801 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?' (DbType = DateTime), @p3='?' (DbType = Binary), @p4='?' (DbType = Binary), @p5='?' (DbType = Binary), @p6='?', @p7='?' (DbType = Binary), @p8='?', @p9='?' (DbType = Int64), @p10='?', @p11='?' (DbType = Binary), @p12='?' (DbType = Boolean), @p13='?', @p14='?', @p15='?' (DbType = Guid), @p16='?' (DbType = Binary), @p17='?', @p18='?' (DbType = Binary), @p19='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "SecureFiles" ("Id", "ContentType", "DeletedAt", "EncryptedChachaKey", "EncryptedFileKey", "EncryptedMetadata", "EncryptionAlgorithm", "FileHash", "FileName", "FileSize", "HashAlgorithm", "IV", "IsDeleted", "KeyId", "OriginalFileName", "OwnerId", "Salt", "StoragePath", "Tag", "UploadedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
2025-06-17 20:59:42.840 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?', @p2='?', @p3='?' (DbType = Guid), @p4='?', @p5='?' (DbType = DateTime), @p6='?', @p7='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FileAuditLogs" ("Id", "Action", "Details", "FileId", "IpAddress", "Timestamp", "UserAgent", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-17 20:59:42.844 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType2`4[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-17 20:59:42.852 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.SecureFilesController.UploadFile (SecureFileStorage.API) in 639.7053ms
2025-06-17 20:59:42.854 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.UploadFile (SecureFileStorage.API)'
2025-06-17 20:59:42.855 +02:00 [INF] Response 60f63ab2-843e-4b5e-9647-92d1de3e2949: 200
2025-06-17 20:59:42.857 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5243/api/SecureFiles/upload - 200 null application/json; charset=utf-8 670.96ms
2025-06-17 21:00:49.749 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5243/api/SecureFiles - null null
2025-06-17 21:00:49.768 +02:00 [INF] Request 8a46956c-d059-4a3a-b1a8-a10304f8c2e7: GET /api/SecureFiles
2025-06-17 21:00:49.770 +02:00 [INF] Executing endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 21:00:49.774 +02:00 [INF] Route matched with {action = "GetUserFiles", controller = "SecureFiles"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserFiles() on controller SecureFileStorage.API.Controllers.SecureFilesController (SecureFileStorage.API).
2025-06-17 21:00:49.780 +02:00 [INF] User 71edeb10-4271-47e2-9b43-71cd805f4680 retrieving files
2025-06-17 21:00:49.802 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT s."Id", s."ContentType", s."DeletedAt", s."EncryptedChachaKey", s."EncryptedFileKey", s."EncryptedMetadata", s."EncryptionAlgorithm", s."FileHash", s."FileName", s."FileSize", s."HashAlgorithm", s."IV", s."IsDeleted", s."KeyId", s."OriginalFileName", s."OwnerId", s."Salt", s."StoragePath", s."Tag", s."UploadedAt"
FROM "SecureFiles" AS s
WHERE s."OwnerId" = @__userId_0 AND NOT (s."IsDeleted")
ORDER BY s."UploadedAt" DESC
2025-06-17 21:00:49.809 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[SecureFileStorage.Core.DTOs.FileDto, SecureFileStorage.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-17 21:00:49.822 +02:00 [INF] Executed action SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API) in 45.0587ms
2025-06-17 21:00:49.824 +02:00 [INF] Executed endpoint 'SecureFileStorage.API.Controllers.SecureFilesController.GetUserFiles (SecureFileStorage.API)'
2025-06-17 21:00:49.825 +02:00 [INF] Response 8a46956c-d059-4a3a-b1a8-a10304f8c2e7: 200
2025-06-17 21:00:49.826 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5243/api/SecureFiles - 200 null application/json; charset=utf-8 77.327ms
2025-06-17 21:01:21.938 +02:00 [INF] Application is shutting down...
2025-06-17 21:13:20.393 +02:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 21:13:20.439 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 21:13:20.794 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 21:13:21.158 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 21:13:21.160 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 21:13:21.169 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 21:13:21.171 +02:00 [INF] Database migration completed successfully
2025-06-17 21:13:21.174 +02:00 [INF] Starting Secure File Storage API
2025-06-17 21:13:21.185 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 21:13:21.235 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 21:13:21.237 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 21:13:21.237 +02:00 [INF] Hosting environment: Development
2025-06-17 21:13:21.238 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 21:14:31.490 +02:00 [INF] Application is shutting down...
2025-06-17 22:31:32.839 +02:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:31:32.880 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 22:31:33.240 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:31:33.604 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:31:33.606 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 22:31:33.615 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 22:31:33.617 +02:00 [INF] Database migration completed successfully
2025-06-17 22:31:33.619 +02:00 [INF] Starting Secure File Storage API
2025-06-17 22:31:33.630 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 22:31:33.672 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 22:31:33.675 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 22:31:33.676 +02:00 [INF] Hosting environment: Development
2025-06-17 22:31:33.677 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 22:33:34.399 +02:00 [INF] Application is shutting down...
2025-06-17 22:35:31.211 +02:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:35:31.247 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 22:35:31.701 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:35:32.038 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:35:32.040 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 22:35:32.049 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 22:35:32.050 +02:00 [INF] Database migration completed successfully
2025-06-17 22:35:32.054 +02:00 [INF] Starting Secure File Storage API
2025-06-17 22:35:32.067 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 22:35:32.111 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 22:35:32.113 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 22:35:32.114 +02:00 [INF] Hosting environment: Development
2025-06-17 22:35:32.114 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 22:36:14.735 +02:00 [INF] Application is shutting down...
2025-06-17 22:45:20.414 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:45:20.454 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 22:45:20.782 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:45:21.109 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:45:21.112 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 22:45:21.120 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 22:45:21.122 +02:00 [INF] Database migration completed successfully
2025-06-17 22:45:21.124 +02:00 [INF] Starting Secure File Storage API
2025-06-17 22:45:21.137 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 22:45:21.179 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 22:45:21.181 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 22:45:21.182 +02:00 [INF] Hosting environment: Development
2025-06-17 22:45:21.183 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 22:48:21.439 +02:00 [INF] Application is shutting down...
2025-06-17 22:48:44.875 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:48:44.914 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 22:48:45.245 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:48:45.586 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-06-17 22:48:45.589 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-17 22:48:45.598 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-06-17 22:48:45.600 +02:00 [INF] Database migration completed successfully
2025-06-17 22:48:45.603 +02:00 [INF] Starting Secure File Storage API
2025-06-17 22:48:45.615 +02:00 [INF] User profile is available. Using 'C:\Users\Lenovo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-17 22:48:45.657 +02:00 [INF] Now listening on: http://localhost:5243
2025-06-17 22:48:45.660 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-17 22:48:45.661 +02:00 [INF] Hosting environment: Development
2025-06-17 22:48:45.661 +02:00 [INF] Content root path: C:\Users\Lenovo\RiderProjects\SecureFileStorage\src\SecureFileStorage.API
2025-06-17 22:50:07.024 +02:00 [INF] Application is shutting down...
